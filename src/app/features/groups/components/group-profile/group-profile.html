<div class="group-profile-container">
  <div class="row">

    <!-- Group Information Section - Right Side -->
    <div class="col-md-4">
      <div class="student-personals-grp">
        <div class="card">
          <div class="card-body pt-2">
            <div class="heading-detail d-flex justify-content-between align-items-center">
              <h4 class="mb-2 mt-2">{{ 'groups.profile.groupData' | translate }}</h4>

              <div class="form-group students-up-files mb-1" *ngIf="permissionAccess.canEdit.group">
                <edit-icon-button (onClick)="onEditGroup()" [showOutline]="true"/>
              </div>
            </div>

            <hr class="mt-2 heading-line" />

            <div class="personal-activity">
              <div class="personal-icons">
                <i class="fas fa-solid fa-users"></i>
              </div>
              <div class="views-personal">
                <h4>{{ 'shared.labels.name' | translate }}</h4>
                <h5>{{ group.name }}</h5>
              </div>
            </div>

            <div class="personal-activity">
              <div class="personal-icons">
                <i class="fas fa-solid fa-book"></i>
              </div>
              <div class="views-personal">
                <h4>{{ 'courses.one' | translate }}</h4>
                <h5>{{ group.course?.name }}</h5>
              </div>
            </div>

            <div class="personal-activity">
              <div class="personal-icons">
                <i class="fas fa-solid fa-chalkboard-teacher"></i>
              </div>
              <div class="views-personal">
                <h4>{{ 'teachers.one' | translate }}</h4>
                <h5>
                  <span class="clickable-text" (click)="onTeacherClick()">
                    {{ group.teacher?.name }}
                  </span>
                </h5>
              </div>
            </div>

            <div class="personal-activity">
              <div class="personal-icons">
                <i class="fas fa-solid fa-user-graduate"></i>
              </div>
              <div class="views-personal">
                <h4>{{ 'shared.labels.numberOfStudents' | translate }}</h4>
                <h5>{{ group.numberOfStudents || 0 }}</h5>
              </div>
            </div>

            <div class="personal-activity" *ngIf="permissionAccess.canEdit.group">
              <div class="personal-icons">
                <i class="fas fa-solid fa-users-cog"></i>
              </div>
              <div class="views-personal">
                <h4>{{ 'shared.labels.capacity' | translate }}</h4>
                <h5>{{ group.capacity || 0 }}</h5>
              </div>
            </div>

            <div class="personal-activity" *ngIf="permissionAccess.canEdit.group">
              <div class="personal-icons">
                <i class="fas fa-solid fa-chart-pie"></i>
              </div>
              <div class="views-personal">
                <h4>{{ 'shared.labels.capacityStatus' | translate }}</h4>
                <h5>
                  <span class="badge badge-status" [style.background-color]="getCapacityStatusColor()">
                    {{ getCapacityStatus() }}
                  </span>
                </h5>
              </div>
            </div>

            <!-- Capacity Progress Bar -->
            <div class="personal-activity" *ngIf="permissionAccess.canEdit.group">
              <div class="personal-icons">
                <i class="fas fa-solid fa-percentage"></i>
              </div>
              <div class="views-personal w-100">
                <h4>{{ 'shared.labels.capacityPercentage' | translate }}</h4>
                <h5>
                  <div class="progress" style="height: 8px; margin-top: 5px;">
                    <div class="progress-bar" [style.width.%]="getCapacityPercentage()"
                      [style.background-color]="getCapacityStatusColor()">
                    </div>
                  </div>
                  <small class="text-muted">{{ getCapacityPercentage() }}%</small>
                </h5>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Students Section - Left Side -->
    <div class="col-md-8">

      <p-card class="tabs-card">
        <div class="student-personals-grp">


          <p-tabs value="0" scrollable>

            <p-tablist>
              <p-tab value="0">
                <i class="fas fa-solid fa-calendar-alt"></i>
                <span class="ms-1"></span>
                {{ 'shared.tabs.schedule' | translate }}
              </p-tab>

              <p-tab value="1">
                <i class="fas fa-clipboard-check"></i>
                <span class="ms-1"></span>
                {{ 'shared.tabs.attendance' | translate }}
              </p-tab>

              <p-tab value="2">
                <i class="fas fa-solid fa-user-graduate"></i>
                <span class="ms-1"></span>
                {{ 'students.all' | translate }}
              </p-tab>
            </p-tablist>

            <p-tabpanels class="px-0">

              <p-tabpanel value="0">

                  <group-daily-schedule [group]="group" />

              </p-tabpanel>

              <p-tabpanel value="1">

                <div class="hello-park">

                  <div class="d-flex justify-content-between">
                    <h5>{{ 'shared.tabs.attendance' | translate }}</h5>

                  </div>

                  <div class="table-container  auto-hover-scroll" *ngIf="group.attendces && group.attendces.length > 0">

                    <table>

                      <thead>
                        <tr>
                          <th>{{ 'shared.labels.date' | translate }}</th>
                          <th class="text-center">{{ 'attendanceStatus.present' | translate }}</th>
                          <th class="text-center">{{ 'attendanceStatus.late' | translate }}</th>
                          <th class="text-center">{{ 'attendanceStatus.absent' | translate }}</th>
                          <th class="text-center">{{ 'shared.labels.total' | translate }}</th>
                        </tr>
                      </thead>

                      <tbody>
                        <tr *ngFor="let attendance of group.attendces" class="class-row">
                          <td class="py-4 clickable-text student-name" (click)="onAttendanceClick(attendance.sessionId)">
                            {{ attendance.date | date:'dd/MM/yyyy' }}
                          </td>
                          <td class="py-4 text-center student-name text-success">
                            {{ attendance.present }}
                          </td>
                          <td class="py-4 text-center student-name text-warning">
                            {{ attendance.late }}
                          </td>
                          <td class="py-4 text-center student-name text-danger">
                            {{ attendance.absent }}
                          </td>
                          <td class="py-4 text-center student-name">
                            {{ attendance.present + attendance.late + attendance.absent }}
                          </td>
                        </tr>
                      </tbody>

                    </table>

                  </div>

                  <no-data [icon]="'fas fa-users'" [text]="'shared.noData.noAttendances' | translate"
                    *ngIf="!group.attendces || group.attendces.length === 0" />

                </div>

              </p-tabpanel>
              
              <p-tabpanel value="2">

                <div class="hello-park">

                  <div class="d-flex justify-content-between">
                    <h5>{{ 'students.all' | translate }}</h5>

                    <div class="form-group students-up-files auto-hover-scroll" *ngIf="permissionAccess.canEdit.group">
                      <edit-icon-button (onClick)="onAddStudent()" [showOutline]="true"/>
                    </div>
                  </div>

                  <div class="table-container" *ngIf="group.students && group.students.length > 0">

                    <table>

                      <thead>
                        <tr>
                          <th>{{ 'students.one' | translate }}</th>
                        </tr>
                      </thead>

                      <tbody>
                        <tr *ngFor="let student of group.students" class="class-row">
                          <td class="py-4 clickable-text student-name" 
                            [ngClass]="{'clickable-text': permissionAccess.canView.studentProfile}"
                            (click)="permissionAccess.canView.studentProfile ? onStudentClick(student.id) : null">
                            {{ student.name }}
                          </td>
                        </tr>
                      </tbody>

                    </table>

                  </div>

                  <no-data [icon]="'fas fa-user-graduate'" [text]="'shared.noData.noStudents' | translate"
                    *ngIf="!group.students || group.students.length === 0" />

                </div>

              </p-tabpanel>

            </p-tabpanels>

          </p-tabs>

        </div>
      </p-card>

    </div>

  </div>
</div>


<app-group-from [showDialog]="showDialog" [group]="group" (onSave)="loadGroup(group.id)" (onCancel)="showDialog = false"
  *ngIf="permissionAccess.canDelete.group && showDialog" />

<students-dialog [showDialog]="showStudentsDialog" [selectedStudents]="group.students || []" (onSave)="onSaveStudents($event)"
  (onCancel)="showStudentsDialog = false" *ngIf="showStudentsDialog" />