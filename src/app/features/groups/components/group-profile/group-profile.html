<div class="group-profile-container">

  <personal-tabs [tabs]="tabs" (activeTabChange)="onActiveTabChange($event)" />

  <p-card class="profile-tabs-card">

    @if(activeTab === 'groups.profile.groupData') {
    <div class="contact-info teacher-personals-grp student-personals-grp">

      <div class="d-flex justify-content-between header-title">
        <h5 class="mb-1">{{ 'groups.profile.groupData' | translate }}</h5>

        <div class="form-group students-up-files mb-1" *ngIf="permissionAccess.canEdit.group">
          <edit-icon-button (onClick)="onEditGroup()" [showOutline]="true" />
        </div>
      </div>

      <div class="personal-activity">
        <div class="personal-icons">
          <i class="fas fa-solid fa-users"></i>
        </div>
        <div class="views-personal">
          <h4>{{ 'shared.labels.name' | translate }}</h4>
          <h5>{{ group.name }}</h5>
        </div>
      </div>

      <div class="personal-activity">
        <div class="personal-icons">
          <i class="fas fa-book-reader"></i>
        </div>
        <div class="views-personal">
          <h4>{{ 'courses.one' | translate }}</h4>
          <h5>{{ group.course?.name }}</h5>
        </div>
      </div>

      <div class="personal-activity">
        <div class="personal-icons">
          <i class="fas fa-solid fa-chalkboard-teacher"></i>
        </div>
        <div class="views-personal">
          <h4>{{ 'teachers.one' | translate }}</h4>
          <h5>
            <span class="clickable-text" (click)="onTeacherClick()">
              {{ group.teacher?.name }}
            </span>
          </h5>
        </div>
      </div>

      <div class="personal-activity">
        <div class="personal-icons">
          <i class="fas fa-solid fa-user-graduate"></i>
        </div>
        <div class="views-personal">
          <h4>{{ 'shared.labels.numberOfStudents' | translate }}</h4>
          <h5>{{ group.numberOfStudents || 0 }}</h5>
        </div>
      </div>

      <div class="personal-activity" *ngIf="permissionAccess.canEdit.group">
        <div class="personal-icons">
          <i class="fas fa-solid fa-users-cog"></i>
        </div>
        <div class="views-personal">
          <h4>{{ 'shared.labels.capacity' | translate }}</h4>
          <h5>{{ group.capacity || 0 }}</h5>
        </div>
      </div>

      <div class="personal-activity" *ngIf="permissionAccess.canEdit.group">
        <div class="personal-icons">
          <i class="fas fa-solid fa-chart-pie"></i>
        </div>
        <div class="views-personal">
          <h4>{{ 'shared.labels.capacityStatus' | translate }}</h4>
          <h5>
            <span class="badge badge-status" [style.background-color]="getCapacityStatusColor()">
              {{ getCapacityStatus() }}
            </span>
          </h5>
        </div>
      </div>

      <!-- Capacity Progress Bar -->
      <div class="personal-activity" *ngIf="permissionAccess.canEdit.group">
        <div class="personal-icons">
          <i class="fas fa-solid fa-percentage"></i>
        </div>
        <div class="views-personal w-100">
          <h4>{{ 'shared.labels.capacityPercentage' | translate }}</h4>
          <h5>
            <div class="progress" style="height: 8px; margin-top: 5px;">
              <div class="progress-bar" [style.width.%]="getCapacityPercentage()"
                [style.background-color]="getCapacityStatusColor()">
              </div>
            </div>
            <small class="text-muted">{{ getCapacityPercentage() }}%</small>
          </h5>
        </div>
      </div>

    </div>
    }

    @if(activeTab === 'shared.tabs.schedule') {
    <group-daily-schedule [group]="group" />
    }

    @if(activeTab === 'shared.tabs.attendance') {

    <div class="d-flex justify-content-between header-title">
      <h5>{{ 'shared.tabs.attendance' | translate }}</h5>

      <pdf-year-month-btns [showPdfBtn]="false" (onYearChanged)="loadAttendances($event, selectedMonth)"
        (onMonthChanged)="loadAttendances(selectedYear, $event.month)" [selectedYear]="selectedYear"
        [selectedMonth]="selectedMonth" />
    </div>

    <div class="tab-overflow-auto" *ngIf="group.attendces && group.attendces.length > 0">
      <app-table [columns]="attendaceTableColumns" [rows]="group.attendces || []" />
    </div>

    <no-data [icon]="'fas fa-users'" [text]="'shared.noData.noAttendances' | translate"
      *ngIf="!group.attendces || group.attendces.length === 0" />

    }

    @if(activeTab === 'students.all') {
    <div class="d-flex justify-content-between header-title">
      <h5>{{ 'students.all' | translate }}</h5>

      <div *ngIf="permissionAccess.canEdit.group">
        <edit-icon-button (onClick)="onAddStudent()" [showOutline]="true" />
      </div>
    </div>

    <div class="tab-overflow-auto" *ngIf="group.students && group.students.length > 0">
      <app-table [columns]="studentTableColumns" [rows]="group.students || []" />
    </div>

    <no-data [icon]="'fas fa-user-graduate'" [text]="'shared.noData.noStudents' | translate"
      *ngIf="!group.students || group.students.length === 0" />

    }

  </p-card>

  <app-group-from [showDialog]="showDialog" [group]="group" (onSave)="loadGroup(group.id)"
    (onCancel)="showDialog = false" *ngIf="permissionAccess.canDelete.group && showDialog" />

  <students-dialog [showDialog]="showStudentsDialog" [selectedStudents]="group.students || []"
    (onSave)="onSaveStudents($event)" (onCancel)="showStudentsDialog = false" *ngIf="showStudentsDialog" />