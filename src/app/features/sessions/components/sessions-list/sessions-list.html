<div class="sessions-container">

  <div class="sessions-header">
    <h2>{{ 'sessions.list.title' | translate }}</h2>

    <div>

      <pdf-icon-btn 
      [showOutline]="true"
      *ngIf="sessions.length > 0 && permissionService.canExport.exportSessionsPdf"
      (click)="exportToPdf()"/>

      &nbsp;

      <button class="btn btn-sm btn-outline-secondary" (click)="showSearchDialog = true"
        [pTooltip]="'shared.buttons.search' | translate" tooltipPosition="top"
        [ngClass]="{'btn-warning': hasActiveSearch()}">
        <i [ngClass]="{'fas fa-filter': !hasActiveSearch(), 'pi pi-filter-slash': hasActiveSearch()}"></i>
      </button>

      &nbsp;

      <button class="btn btn-sm btn-outline-primary" *ngIf="permissionService.canAdd.refreshSessions"
        (click)="refreshSessions()" [pTooltip]="'shared.buttons.refresh' | translate" tooltipPosition="top">
        <i class="fas fa-sync"></i>
      </button>

    </div>

  </div>

  <!-- Search Criteria Display -->
  <div class="search-criteria-display" *ngIf="hasActiveSearch()">
    <div class="criteria-info">
      <i class="fas fa-filter"></i>
      <span>{{ 'sessions.search.activeFilters' | translate }}:</span>
      <div class="criteria-items">
        <div class="criteria-item" *ngFor="let item of getSearchCriteriaItems()">
          <span class="criteria-key">{{ item.key }}:</span>
          <span class="criteria-value">{{ item.value }}</span>
          <button class="remove-criteria-btn" 
            (click)="removeSearchCriteria(item.key)"
            [pTooltip]="'sessions.search.removeFilter' | translate" 
            tooltipPosition="top">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      <button class="btn btn-sm btn-outline-danger clear-filters-btn" (click)="clearSearchCriteria()"
        [pTooltip]="'sessions.search.clearAllFilters' | translate" tooltipPosition="top">
        <i class="fas fa-times"></i>
        {{ 'sessions.search.clearAll' | translate }}
      </button>
    </div>
  </div>

</div>


<div class="sessions-grid" *ngIf="sessions.length > 0; else noSessions">
  <session-card *ngFor="let session of sessions" [session]="session" (recordAttendance)="onRecordAttendance($event)"
    (update)="updateSession($event)" (cancel)="cancelSession($event)" (markCompleted)="markCompletedSession($event)"
    (reschedule)="rescheduleSession($event)" (delete)="deleteSession($event)">
  </session-card>
</div>

<!-- Session Form Dialog -->
<session-form *ngIf="showSessionForm && permissionService.canEdit.session" [showDialog]="showSessionForm"
  [session]="sessionToEdit" (onSave)="onSessionUpdated()" (onCancel)="onSessionFormCancelled()">
</session-form>

<session-search-dialog *ngIf="showSearchDialog" [showDialog]="showSearchDialog"
  [currentCriteria]="currentSearchCriteria" (onSearch)="onSearch($event)"
  (onCancel)="onSearchCancel()"></session-search-dialog>

<ng-template #noSessions>
  <div class="no-sessions">
    <i class="fa fa-calendar-times"></i>
    <p>{{ 'sessions.list.noSessions' | translate }}</p>
  </div>
</ng-template>

<!-- Hidden PDF Template for Export -->
<div style="position: absolute; left: -9999px; top: -9999px;">
  <sessions-list-pdf-template
    [sessions]="sessions"
    [title]="'sessions.list.title' | translate">
  </sessions-list-pdf-template>
</div>